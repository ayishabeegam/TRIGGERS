# TRIGGERS
CREATE DATABASE TRIGGERS1;
USE TRIGGERS1;
CREATE TABLE TEACHERS(ID INT PRIMARY KEY, NAME VARCHAR(30), SUBJECT VARCHAR(30), EXPERIENCE VARCHAR(30),SALARY INT);
INSERT INTO TEACHERS VALUES(1,'AYSHA','MATHS','2 YEARS',20000);
INSERT INTO TEACHERS VALUES(2,'NYNA','PHYSICS','1 YEARS',10000);
INSERT INTO TEACHERS VALUES(3,'NYHA','CHEMISTRY','1.5 YEARS',15000);
INSERT INTO TEACHERS VALUES(4,'SHIBIN','BIOLOGY','3 YEARS',30000);
INSERT INTO TEACHERS VALUES(5,'MAMATHA','SOCIAL','1.3 YEARS',130000);
INSERT INTO TEACHERS VALUES(6,'SHIJILA','ACCOUNTANCY','3.5 YEARS',35000);
INSERT INTO TEACHERS VALUES(7,'ALEENA','COMMERCE','4 YEARS',40000);
INSERT INTO TEACHERS VALUES(9,'DEVU','COMPUTER','1 YEARS',10000);
SELECT * FROM TEACHERS;
#BEFORE INSERT TRIGGER
DELIMITER $$

CREATE TRIGGER before_insert_teacher BEFORE INSERT ON TEACHERS FOR EACH ROW
BEGIN
if new.salary<=0 then
    SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT='SALARY CANNOT BE NEGATIVE';
	END IF;
END $$
DELIMITER ;

SHOW TRIGGERS; 
INSERT INTO TEACHERS VALUES(10,'SHAHANA','MATHS','1.8 YEARS',0);


CREATE TABLE TEACHER_LOG(TEACHER_ID INT, ACTION VARCHAR(30),TIME_STAMP DATETIME);
delimiter //
CREATE TRIGGER after_insert_teacher AFTER INSERT ON TEACHERS FOR EACH ROW
BEGIN
INSERT INTO TEACHER_LOG VALUES(NEW.ID,'AFTER INSERT',NOW());
END //
DELIMITER ;

INSERT INTO TEACHERS VALUES(11,'DEVAA','MECH','11 YEARS',50000);
SELECT * FROM TEACHER_LOG;

INSERT INTO TEACHERS VALUES(12,'DEVANJANA','COMPUTER','13 YEARS',55000);


DELIMITER $$
CREATE TRIGGER before_delete_teacher1 BEFORE DELETE ON TEACHERS FOR EACH ROW
BEGIN
IF OLD.EXPERIENCE IS NOT NULL THEN
SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT='CANNOT DELETE';
END IF;
END $$

DELIMITER ;

DELETE FROM TEACHERS WHERE ID=1;
DROP TRIGGER before_delete_teacher1;

DELIMITER $$
CREATE TRIGGER after_delete_teacher AFTER DELETE ON TEACHERS FOR EACH ROW
BEGIN
INSERT INTO TEACHER_LOG SET TEACHER_ID=OLD.ID;
END $$

DELIMITER ;



